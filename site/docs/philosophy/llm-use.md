# LLM use

A lot of the complicated typescript machinery in this library is generated
via LLM (almost exclusively Claude Code with Opus 4.5). This helps keep the cognitive load
manageable; specific edge cases within the IndexedDB spec can be explained in
natural language, and the agent works out how to encode that in the type system
while also passing all the pre-existing tests.

This library is, in part, an experiment in how effective that strategy is.

## Spec-driven development

As many guardrails as possible need to be set for the LLM to ensure that the
complicated types work for more than just the current feature being worked on.
That includes runtime tests (using [`fake-indexeddb`](https://github.com/dumbmatter/fakeIndexedDB) to mock real database setup
and interaction). But to an even larger extent, since most of the library's
functionality is compile-time only, it involves type-level tests which assert
that the expected compile-time errors are actually being thrown.

This is done first through a series of `*.test-types.ts` files in the repo which
have `// @ts-expect-error` comments in them. All of these files are included in
typechecking and will fail the build if the expected errors are not thrown.

An even more effective strategy is using [documentation as tests](/philosophy/documentation-as-tests),
where the same tests cases which prove that the library upholds certain
guarantees can also be used to communicate those same capabilities to the user.

## Providing good reference examples

Some of the techniques used in this library are far enough from the mainstream
of Typescript usage that agents may not immediately reach for the most
efficacious patterns. To help guide the LLM towards better solutions, it's
helpful to prompt it with reference examples to seed the context window before
tackling a feature. A few good examples include:

- [`type-fest`](https://github.com/sindresorhus/type-fest/tree/main), especially
  their arithmetic implementations
- [`type-challenges`](https://tsch.js.org/) and their solutions
- [`arktype`](https://github.com/arktypeio/arktype) including the mind-bending [`arkregex`](https://arktype.io/docs/blog/arkregex)

This can go a long way in terms of nudging the LLM towards more elegant and
performant ways to express complex type-level logic.

## Documentation

With very limited exceptions (such as perhaps some introductory sentences leading
into code snippets), all documentation (including this sentence) is *hand
written* and not generated by LLM in order to preserve the clarity and intent of
the reasoning behind design decisions with as high fidelity as possible.